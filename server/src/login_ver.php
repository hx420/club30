<?php require_once 'conn.php'; require_once './statusCode.php'; $username = $_POST['username']; $password = $_POST['password']; $statusCode = $_POST['statusCode']; $loginType = $_POST['loginType']; if (isset($statusCode) && isValidStatusCode($statusCode)) { if($loginType == 'user'){ $sel = $conn->prepare("SELECT passwd FROM userdata WHERE phone = ? OR qq = ?"); $sel->bind_param('ss', $username, $username); if($sel->execute() === TRUE){ $result = $sel->get_result(); if ($result->num_rows > 0) { $row = $result->fetch_assoc(); $verPasswd = $row['passwd']; if($verPasswd == $password){ $info = $conn->prepare("SELECT name,sex,cclass,year,class,phone,qq,politicalStatus,partOne,partTow,interviewed,slefIntroduce,type FROM userdata WHERE phone = ? OR qq = ?"); $info->bind_param('ss', $username, $username);$info->execute();$resul = $info->get_result();$infoData = $resul->fetch_object(); header('Content-Type: application/json');echo json_encode([ 'errno' => 0,'userType' => $infoData,'message' => '登录成功！3秒后跳转！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '密码错误，请重试！' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '账号不存在，检查账号试试？别急，账号可以是QQ或者手机号，重新试试？如果登录成功，记得改掉错误那个噢！' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '程序错误，错误码：3307。请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($loginType == 'minister' || $loginType == 'admin'){ $sel = $conn->prepare("SELECT passwd FROM admin_data WHERE account = ? AND type = ?"); $sel->bind_param('ss', $username,$loginType); if($sel->execute() === TRUE){ $result = $sel->get_result(); if ($result->num_rows > 0) { $row = $result->fetch_assoc();$verPasswd = $row['passwd']; if($verPasswd == $password){ $verCode = rand(10000000000,99999999999); $selLogs = $conn->prepare("SELECT * FROM login_logs WHERE userAccount = ?"); $selLogs->bind_param('s', $username);$selLogs->execute();$resu = $selLogs->get_result(); if($resu->num_rows > 0){ $upVer = $conn->prepare("UPDATE login_logs SET userVerCode = ?  WHERE userAccount = ?"); $upVer->bind_param('ss', $verCode,$username); if($upVer->execute() === TRUE){ $info = $conn->prepare("SELECT username,account,type,remarks FROM admin_data WHERE account = ?"); $info->bind_param('s', $username); $info->execute();$resul = $info->get_result();$infoData = $resul->fetch_object(); header('Content-Type: application/json');echo json_encode([ 'errno' => 0,'userType' => $infoData,'verCode' => $verCode,'message' => '登录成功！3秒后跳转！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '程序错误，错误码：3307。请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{ $upVer = $conn->prepare("INSERT INTO login_logs (userAccount,userVerCode) VALUES (?,?)"); $upVer->bind_param('ss', $username,$verCode); if($upVer->execute() === TRUE){ $info = $conn->prepare("SELECT username,account,type,remarks FROM admin_data WHERE account = ?"); $info->bind_param('s', $username); $info->execute();$resul = $info->get_result();$infoData = $resul->fetch_object(); header('Content-Type: application/json');echo json_encode([ 'errno' => 0,'userType' => $infoData,'verCode' => $verCode,'message' => '登录成功！3秒后跳转！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '程序错误，错误码：3307。请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} } }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '密码错误，请重试！' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '账号不存在!!!' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '程序错误，错误码：3307。请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '参数错误，请刷新重试！！！' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '无权访问！！！' ]);} ?>  