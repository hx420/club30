<?php require_once 'conn.php'; require_once './statusCode.php'; $statusCode = $_POST['statusCode']; if (isset($statusCode) && isValidStatusCode($statusCode)){ $uploadDir = 'QRCode/'; if ($_SERVER['REQUEST_METHOD'] !== 'POST') { header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '未接收到文件哦(post)！', ]); }else{ if (!isset($_FILES['file'])) { header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '未接收到文件哦(save)！', ]); }else{ $file = $_FILES['file'];  $partId = $_POST['partId'];  $partName = $_POST['partName'];  $fileName = $file['name']; $fileType = pathinfo($fileName, PATHINFO_EXTENSION); $fileTmpPath = $file['tmp_name']; $rand = rand(100000, 999999); $newFileName = time().'_JsBlog_'.$rand.'.'.$fileType; $targetPath = __DIR__ . '/' . $uploadDir . $newFileName; move_uploaded_file($file['tmp_name'], $targetPath); $fileUrl = $baseURL.'src/'. $uploadDir . $newFileName; $sql = $conn->prepare("UPDATE config_data SET url = ? WHERE id = ? AND value = ?"); $sql->bind_param('sss',$fileUrl,$partId,$partName); if($sql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '上传并保存成功！！', 'url' => $fileUrl ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3306...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} } } }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '无权访问！！！' ]);} ?>  