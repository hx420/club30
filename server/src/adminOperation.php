<?php require_once 'conn.php'; require_once './statusCode.php'; $statusCode = $_POST['statusCode']; $adminType = $_POST['adminType']; if (isset($statusCode) && isValidStatusCode($statusCode)){ if($adminType == 'showSet'){ $club_name = $_POST['club_name']; $system_time = $_POST['system_time']; $system_title = $_POST['system_title']; $club_introduce = $_POST['club_introduce']; $club_president = $_POST['club_president']; $club_president_phone = $_POST['club_president_phone']; $public_text = $_POST['public_text']; $active_time = $_POST['active_time'];$active_postion = $_POST['active_postion']; $upSql = $conn->prepare("UPDATE system_config SET club_name = ?, system_time = ?, system_title = ?, club_introduce = ?, club_president = ?, club_president_phone = ?, public_text = ? , active_time = ? , active_postion = ? WHERE id = '3306'"); $upSql->bind_param('sssssssss',$club_name, $system_time, $system_title, $club_introduce, $club_president, $club_president_phone, $public_text, $active_time, $active_postion); if($upSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '保存成功！！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3306...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($adminType == 'recruitSet'){ $opType = $_POST['opType']; if($opType == 'addData'){ $addValue = $_POST['addValue'];$addIntroduce = $_POST['addIntroduce'];$addType = $_POST['addType']; $addSql = $conn->prepare("INSERT INTO config_data (value,type,introduce) VALUES (?,?,?)"); $addSql->bind_param('sss',$addValue, $addType, $addIntroduce); if($addSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '添加成功！！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3307...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($opType == 'delData'){ $delId = $_POST['delId']; $delSql = $conn->prepare("DELETE FROM config_data WHERE id = ?"); $delSql->bind_param('s',$delId); if($delSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '删除成功！！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3308...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($opType == 'upData'){ $upId = $_POST['upId'];$upValue = $_POST['upValue'];$upIntroduce = $_POST['upIntroduce']; $upSql = $conn->prepare("UPDATE config_data SET value = ?, introduce = ? WHERE id = ?"); $upSql->bind_param('sss',$upValue, $upIntroduce, $upId); if($upSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '修改成功！！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3309...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => 'optype参数传递错误，请刷新重试！！！' ]);} }else if($adminType == 'accountSet'){ $opType = $_POST['opType']; if($opType == 'selData'){ $result = $conn->query("SELECT * FROM admin_data"); if ($conn->error) { die("FALSE：" . $conn->error); } $adminData = $result -> fetch_all(MYSQLI_ASSOC); header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'info' => $adminData ]); }else if($opType == 'delData'){ $delAccount = $_POST['delAccount']; $delSql = $conn->prepare("DELETE FROM admin_data WHERE account = ?"); $delSql->bind_param('s',$delAccount); if($delSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '删除成功！！']); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3310...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($opType == 'addData'){ $addAccountUserName = $_POST['addAccountUserName'];$addAccountPasswd = $_POST['addAccountPasswd']; $addAccountRemarks = $_POST['addAccountRemarks'];$addAccountType = $_POST['addAccountType']; $account  = rand(100000, 999999); $selSql = $conn->prepare("SELECT * FROM admin_data WHERE username = ?"); $selSql->bind_param('s',$addAccountUserName); if($selSql->execute() === TRUE){ $result = $selSql->get_result(); $row = $result->fetch_assoc(); $selName = $row['username']; if($selName == $addAccountUserName){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '该用户已存在！！！' ]); }else{ $sqlAdmin = $conn->query("SELECT * FROM admin_data WHERE type = 'admin'"); $adminRow = $sqlAdmin->num_rows; if($addAccountType == 'admin'){ if($adminRow >= 4){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '除去作者账号，最多设置3个负责人级别！！！' ]); }else{ $addSql = $conn->prepare("INSERT INTO admin_data (username,account,passwd,type,remarks) VALUES (?,?,?,?,?)"); $addSql->bind_param('sssss',$addAccountUserName, $account, $addAccountPasswd, $addAccountType, $addAccountRemarks); if($addSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '添加成功！！账号为：'.$account ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3311...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} } }else{ $addSql = $conn->prepare("INSERT INTO admin_data (username,account,passwd,type,remarks) VALUES (?,?,?,?,?)"); $addSql->bind_param('sssss',$addAccountUserName, $account, $addAccountPasswd, $addAccountType, $addAccountRemarks); if($addSql->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '添加成功！！账号为：'.$account ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3312...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} } } }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3313...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => 'optype参数传递错误，请刷新重试！！！' ]);} }else if($adminType == 'manageInfo'){ $opType = $_POST['opType']; if($opType == 'piLiangLuQu'){ $checkBoxData = $_POST['checkBoxData'];$checkBoxPart = $_POST['checkBoxPart']; foreach ($checkBoxData as $id) { $sql = "UPDATE userdata SET result = ? WHERE id = ?"; $stmt = $conn->prepare($sql); $stmt->bind_param("si", $checkBoxPart, $id); if ($stmt->execute() === TRUE) { } else {$error = true;break;} } if ($error) { header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]); }  else { header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '录取成功！！' ]); } }else if($opType == 'danRenLuQu'){ $userId = $_POST['userId'];$userPart = $_POST['userPart']; $danren = $conn->prepare('UPDATE userdata SET result = ? WHERE id = ?'); if($danren->bind_param('ss',$userPart, $userId) === TRUE){ if($danren->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '录取成功！！' ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($opType == 'upShow'){ $resultShowData = $_POST['resultShowData']; $upShow = $conn->prepare('UPDATE switch_data SET pageSwitch = ? WHERE pageName = "resultShow"'); if($upShow->bind_param('s',$resultShowData) === TRUE){ if($upShow->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '更改成功！！' ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => 'optype参数传递错误，请刷新重试！！！' ]);} }else if($adminType == 'switchSystem'){ $switchId = $_POST['switchId']; $newSwitch = $_POST['newSwitch']; $upShow = $conn->prepare('UPDATE switch_data SET pageSwitch = ? WHERE id = ?'); if($upShow->bind_param('ss',$newSwitch,$switchId) === TRUE){ if($upShow->execute() === TRUE){ header('Content-Type: application/json'); echo json_encode([ 'errno' => 0, 'message' => '更改成功！！' ]); }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '系统错误，错误码：3314...请重试或者联系管理员！作者QQ：'.$systemAdminQq ]);} }else if($adminType == 'exportInfo'){ }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '参数传递错误，请刷新重试！！！' ]);} }else{header('Content-Type: application/json'); echo json_encode([ 'errno' => 1, 'message' => '无权访问！！！' ]);} ?>   