 <!DOCTYPE html> <html lang="charset"> <head> <meta charset="UTF-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <title>小江江系统数据库初始化</title> </head> <body> <div> <h3>数据库连接信息</h3> <?php if ($_SERVER["REQUEST_METHOD"] == "POST") { $servername = $_POST["servername"];$username = $_POST["username"];$password = $_POST["password"];$dbname = $_POST["dbname"];$userPasswd = $_POST["userPasswd"];$baseURL = $_POST["baseURL"]; $conn = new mysqli($servername, $username, $password); if($conn->connect_error){ die("数据库连接失败：" . $conn->connect_error); }else{ $filename = "dbase.csv"; $data = array( array("servername" => $servername,"username" => $username,"password" => $password,"dbname" => $dbname,"userPasswd" => $userPasswd,"baseURL" => $baseURL),); $fp = fopen($filename, "w"); foreach ($data as $row) {fputcsv($fp, $row);}fclose($fp); $filenameCsv = "dbase.csv";$dataInfoDB = array();$fpDB = fopen($filenameCsv, "r"); while (($rowDB = fgetcsv($fpDB)) !== FALSE) {$dataInfoDB[] = $rowDB;}fclose($fpDB); $servernamet = $dataInfoDB[0][0];$usernamet = $dataInfoDB[0][1];$passwordt = $dataInfoDB[0][2];$dbnamet = $dataInfoDB[0][3];$userPasswdt = $dataInfoDB[0][4];$baseURLt = $dataInfoDB[0][5]; $connt = new mysqli($servernamet, $usernamet, $passwordt); if($connt->connect_error){ die("数据库连接失败：" . $connt->connect_error); }else{ echo "<div style='text-align: center;background: #000000c6;color: wheat;padding: 0.8em 0em;'>数据库连接成功！<br>"; echo "开始初始化系统数据表！</div>";   ?> </div> <div class="echoBox"> <h3>初始化进程</h3> <style>.echoList li img{width: 1em;aspect-ratio: 1/1;float: right;}</style> <ol class="echoList" style="width: 90%;padding: 5%;background: #000000c6;color: wheat;"> <?php  $creatDb = ["CREATE DATABASE IF NOT EXISTS $dbnamet;","USE $dbnamet;"]; foreach ($creatDb as $query){ob_start();ob_implicit_flush(true);if(mysqli_query($connt, $query)){$creatDbResult = TRUE;}else{$creatDbResult = FALSE;}ob_flush();flush();} if($creatDbResult){echo "<li>"."数据库创建成功！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>";$connY = new mysqli($servernamet, $usernamet, $passwordt, $dbnamet);} else{echo "<li>"."数据库创建失败！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li>";} if($connY->connect_error){ die("数据库连接失败：" . $connY->connect_error); }else{ $createAdminData = [ "DROP TABLE IF EXISTS `admin_data`;", "CREATE TABLE `admin_data` ( `id` int NOT NULL AUTO_INCREMENT, `username` text, `account` text, `passwd` text, `type` text, `time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `remarks` text, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "INSERT INTO `admin_data` VALUES ('1', '江祥盛', 'sysAuthor', 'Linux3306@', 'admin', '2024-02-03 20:22:27', '系统作者');", "INSERT INTO `admin_data` VALUES ('2', '初始管理员', 'admin', 'admin123456', 'admin', '2024-02-03 20:22:55', '负责人');" ]; foreach ($createAdminData as $query){ob_start();ob_implicit_flush(true);if(mysqli_query($connY, $query)){$createAdminDataResult = TRUE;}else{$createAdminDataResult = FALSE;}ob_flush();flush();} if($createAdminDataResult){echo "<li>"."管理员数据表初始化成功！<br>管理员初始账号：admin <br>管理员初始密码：admin123456"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>";} else{echo "<li>"."管理员数据表初始化失败！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li>";} $creatConfigData = [ "DROP TABLE IF EXISTS `config_data`;", "CREATE TABLE `config_data` ( `id` int NOT NULL AUTO_INCREMENT, `value` text, `type` text, `time` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `url` text, `introduce` text, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "INSERT INTO `config_data` VALUES ('1', '人文学院', 'cclass', '2024-01-24 16:19:34', null, null);", "INSERT INTO `config_data` VALUES ('2', '外国语学院', 'cclass', '2024-01-24 16:20:16', null, null);", "INSERT INTO `config_data` VALUES ('3', '政府管理学院（两山学院）', 'cclass', '2024-01-24 16:20:41', null, null);", "INSERT INTO `config_data` VALUES ('4', '大数据学院（数字经济学院）', 'cclass', '2024-01-24 16:21:00', null, null);", "INSERT INTO `config_data` VALUES ('5', '工程技术学院', 'cclass', '2024-01-24 16:21:10', null, null);", "INSERT INTO `config_data` VALUES ('6', '资源环境学院（高黎贡山学院）', 'cclass', '2024-01-24 16:21:29', null, null);", "INSERT INTO `config_data` VALUES ('7', '教育学院', 'cclass', '2024-01-24 16:21:44', null, null);", "INSERT INTO `config_data` VALUES ('8', '体育学院（永子围棋学院）', 'cclass', '2024-01-24 16:22:09', null, null);", "INSERT INTO `config_data` VALUES ('9', '经济管理学院', 'cclass', '2024-01-24 16:22:18', null, null);", "INSERT INTO `config_data` VALUES ('10', '艺术设计与珠宝学院', 'cclass', '2024-01-24 16:22:31', null, null);", "INSERT INTO `config_data` VALUES ('11', '音乐学院', 'cclass', '2024-01-24 16:22:39', null, null);", "INSERT INTO `config_data` VALUES ('12', '马克思主义学院', 'cclass', '2024-01-24 16:22:49', null, null);", "INSERT INTO `config_data` VALUES ('13', '职业与继续教育学院（中小学教师发展学院）', 'cclass', '2024-01-24 16:23:25', null, null);", "INSERT INTO `config_data` VALUES ('14', '创新创业学院', 'cclass', '2024-01-24 16:23:39', null, null);", "INSERT INTO `config_data` VALUES ('15', '总群', 'part', '2024-02-06 20:13:00', 'https://js-1317759028.cos.ap-nanjing.myqcloud.com/jsblog/imgs/system/logo.png', '世界很大，我想去找一片属于自己的天空<br>123123321');", "INSERT INTO `config_data` VALUES ('16', '策划部', 'part', '2024-02-06 20:22:45', 'https://js-1317759028.cos.ap-nanjing.myqcloud.com/jsblog/imgs/system/logo.png', '<p>我于荒芜的祭坛叩拜神明</p>\r\n<p>我可以给你看身上的疤 也可以给你看我的日记 甚至我的心 我可以给你讲述我不堪的过往 但你接近我的片刻 我就开始倒数 你会在第几天抛弃我</p>');", "INSERT INTO `config_data` VALUES ('17', '培训部', 'part', '2024-02-06 20:22:58', 'https://js-1317759028.cos.ap-nanjing.myqcloud.com/jsblog/imgs/system/logo.png', '<p>我于荒芜的祭坛叩拜神明</p>\r\n<p>我可以给你看身上的疤 也可以给你看我的日记 甚至我的心 我可以给你讲述我不堪的过往 但你接近我的片刻 我就开始倒数 你会在第几天抛弃我</p>');", "INSERT INTO `config_data` VALUES ('18', '2020', 'year', '2024-02-03 16:55:27', null, '');", "INSERT INTO `config_data` VALUES ('19', '2021', 'year', '2024-02-03 16:55:33', null, '');", ]; foreach ($creatConfigData as $query){ob_start();ob_implicit_flush(true);if(mysqli_query($connY, $query)){$creatConfigDataResult = TRUE;}else{$creatConfigDataResult = FALSE;}ob_flush();flush();} if($creatConfigDataResult){echo "<li>"."学院、部门、年级信息表初始化成功！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>";} else{echo "<li>"."学院、部门、年级信息表初始化失败！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li>";} $creatLoginLogs = [ "DROP TABLE IF EXISTS `login_logs`;", "CREATE TABLE `login_logs` ( `id` int NOT NULL AUTO_INCREMENT, `userAccount` text, `userVerCode` text, `loginTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "DROP TABLE IF EXISTS `remark_data`;", "CREATE TABLE `remark_data` ( `id` int NOT NULL AUTO_INCREMENT, `remarks` text, `partName` text, `partIdentity` text, `userName` text, `userId` text, `userPhone` text, `firstPart` text, `secondPart` text, `timeData` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "DROP TABLE IF EXISTS `switch_data`;", "CREATE TABLE `switch_data` ( `id` int NOT NULL AUTO_INCREMENT, `pageName` text, `pageSwitch` text, `pageTitle` text, PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "INSERT INTO `switch_data` VALUES ('1', '/insert', 'on', '信息填写');", "INSERT INTO `switch_data` VALUES ('2', '/status', 'on', '进度状态');", "INSERT INTO `switch_data` VALUES ('3', '/minister', 'on', '信息查看');", "INSERT INTO `switch_data` VALUES ('4', 'resultShow', 'off', '录取结果展示');", ]; foreach ($creatLoginLogs as $query){ob_start();ob_implicit_flush(true);if(mysqli_query($connY, $query)){$creatLoginLogsResult = TRUE;}else{$creatLoginLogsResult = FALSE;}ob_flush();flush();} if($creatLoginLogsResult){echo "<li>"."备注、页面控制表初始化成功！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>";} else{echo "<li>"."备注、页面控制表初始化失败！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li>";} $creatSysConfig = [ "DROP TABLE IF EXISTS `system_config`;", "CREATE TABLE `system_config` (`id` int NOT NULL AUTO_INCREMENT,`club_name` text,`club_introduce` text,`system_title` text,`system_time` text,`club_president` text, `club_president_phone` text CHARACTER SET utf8mb4 COLLATE utf8mb4_0900_ai_ci,`system_img_icon` text,`system_img_club` text,`system_img_school` text,`public_text` text,`active_time` text,`active_postion` text,PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;", "INSERT INTO `system_config` VALUES ('3306', '保山学院大学生计算机协会', '阿巴巴，这里是文字简介', '计算机编程大会面试', '2024届', '江墨白', '18888888888', 'https://js-1317759028.cos.ap-nanjing.myqcloud.com/jsblog/imgs/Logo.png', null, 'https://publicimgs-1317759028.cos.ap-nanjing.myqcloud.com/yyxh/bsnc.png', '<p>我于荒芜的祭坛叩拜神明</p>\r\n<p>我可以给你看身上的疤 也可以给你看我的日记 甚至我的心 我可以给你讲述我不堪的过往 但你接近我的片刻 我就开始倒数 你会在第几天抛弃我</p>', '2024年1月2日19:30', '科教楼3306室');", "DROP TABLE IF EXISTS `userdata`;", "CREATE TABLE `userdata` ( `id` int NOT NULL AUTO_INCREMENT,`name` text,`sex` text,`cclass` text,`year` text,`class` text, `phone` text,`qq` text,`politicalStatus` text,`partOne` text,`partTow` text,`interviewed` text, `slefIntroduce` text,`status` text,`result` text,`insertTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP,`resultTime` timestamp NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP, `passwd` text,`type` text,PRIMARY KEY (`id`) ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_general_ci;" ]; foreach ($creatSysConfig as $query){ob_start();ob_implicit_flush(true);if(mysqli_query($connY, $query)){$creatSysConfigResult = TRUE;}else{$creatSysConfigResult = FALSE;}ob_flush();flush();} if($creatSysConfigResult){echo "<li>"."系统参数、用户信息表初始化成功！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>";} else{echo "<li>"."系统参数、用户信息表初始化失败！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li>";} if($createAdminDataResult && $creatConfigDataResult && $creatLoginLogsResult && $creatSysConfigResult){ echo "<li>"."数据库初始化成功！！"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/yess.png' alt='Yes'></li>"; }else{echo "<li>"."啊哦，系统初始化不完全，算是半成！！重试一下···"."<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></li><li>";} } ?> </ol> <?php } } } ?> </div> <style> .footBox p{ text-indent: 2em; display: flex; justify-content: center; align-items: center; padding: 0.8em 0em; flex-flow: wrap; } .footBox h4{ text-align: center; } </style> <div class="footBox" style="background-color: yellowgreen;"> <?php  $tables = array("admin_data" => "管理员及执委数据表", "config_data" => "学院、部门、年级信息数据表", "login_logs" => "登录验证数据表", "remark_data" => "面试成员部门备注表", "switch_data" => "页面控制表", "userdata" => "用户信息表", "system_config" => "系统全局配置表" ); $existingTables = array(); $missingTables = array();  foreach ($tables as $tableName => $chineseName) { $query = "SHOW TABLES LIKE '$tableName'"; $result = mysqli_query($connY, $query); if (mysqli_num_rows($result) > 0) {$existingTables[] = $chineseName; } else { $missingTables[] = $chineseName; } } if (count($missingTables) == 0 && count($existingTables) > 0) { echo "<p>"."欧了，检查了一下，数据库已经初始化成功了，注意，初始化成功后，再次进行初始化的话，会将已拥有的数据重置到默认，且无法找回！！"."</p>"; echo "<p>"."建议初始化成功后删除server目录下的dbinfo.php文件，以免再次初始化导致数据丢失！！"."</p>"; echo "<p><img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/WeChat2.png' alt='赞赏二维码' height='130px'><img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/dog.gif' alt='成功' height='130px'></p><h4>编写不易，随便赞赏一下下？哈哈哈！！</h4>"; } else{echo implode(", ", $missingTables);echo "<p>不存在！！请重试···<img src='https://js-1317759028.cos.ap-nanjing.myqcloud.com/img/no.png' alt='No'></p>";} ?> </div> <div style="background-color: black;color: white;text-align: center;padding: 1em 0;font-size: 0.8em;"> <p> 面试信息管理系统 3.0 </p> <p> CopyRight &copy; 2021 20网络工程 江祥盛. All rights reserved.  </p> </div> </body> </html>